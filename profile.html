<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸ªäººä¸­å¿ƒ</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
* { font-family: 'Inter', sans-serif; }
body { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); min-height: 100vh; padding-bottom: 80px; }
.glass { background: rgba(102, 126, 234, 0.3); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); }
.glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); }
.modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 9999; overflow-y: auto; padding: 20px; }
.modal.show { display: block; }
.nav-glass { background: rgba(102, 126, 234, 0.95); backdrop-filter: blur(20px); border-top: 2px solid rgba(255, 255, 255, 0.5); }
</style>
</head>
<body>

<div class="glass sticky top-0 z-50">
<div class="max-w-md mx-auto px-4 py-6">
<div class="flex flex-col items-center gap-4">
<div class="w-24 h-24 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-5xl">ğŸ‘¤</div>
<div class="text-center">
<h1 class="text-xl font-bold text-white mb-1" id="username">æŠ•èµ„è€…</h1>
<p class="text-xs text-white/80 bg-white/20 px-3 py-1 rounded-full">ID: AI_2026</p>
</div>
</div>
</div>
</div>

<div class="max-w-md mx-auto px-4 py-4 space-y-4">

<div class="glass-card rounded-3xl p-5 shadow-xl">
<h2 class="text-base font-bold mb-3 flex items-center gap-2">
<span>ğŸŒ</span><span id="langTitle">è¯­è¨€è®¾ç½®</span>
</h2>
<div class="grid grid-cols-3 gap-3">
<button onclick="setLanguage('zh')" id="btnZh" class="py-3 rounded-xl font-bold transition-all">ä¸­æ–‡</button>
<button onclick="setLanguage('en')" id="btnEn" class="py-3 rounded-xl font-bold transition-all">English</button>
<button onclick="setLanguage('es')" id="btnEs" class="py-3 rounded-xl font-bold transition-all">EspaÃ±ol</button>
</div>
</div>

<div class="glass-card rounded-3xl p-5 shadow-xl">
<div class="flex justify-between items-center mb-3">
<h2 class="text-base font-bold flex items-center gap-2">
<span>ğŸ“Š</span><span id="historyTitle">å†å²æŠ¥å‘Š</span>
</h2>
<button onclick="loadHistory()" class="text-purple-600 text-xs font-semibold bg-purple-50 px-3 py-1 rounded-lg" id="refreshBtn">åˆ·æ–°</button>
</div>
<div id="historyList" class="space-y-3"></div>
</div>

</div>

<div id="modal" class="modal">
<div class="max-w-2xl mx-auto">
<div class="glass-card rounded-3xl p-6 mb-4">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-bold text-purple-600" id="modalTitle">å®Œæ•´äº¤æ˜“å†³ç­–æŠ¥å‘Š</h3>
<button onclick="closeModal()" class="text-white bg-red-600 rounded-full w-10 h-10 flex items-center justify-center font-bold text-xl hover:bg-red-700 transition-all">âœ•</button>
</div>
<div id="modalBody"></div>
</div>
</div>
</div>

<div class="fixed bottom-0 left-0 right-0 nav-glass z-50">
<div class="max-w-md mx-auto flex justify-around py-3">
<a href="index.html" class="flex flex-col items-center gap-1 py-2 px-4">
<svg class="w-6 h-6 text-white opacity-70" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/></svg>
<span class="text-xs font-bold text-white opacity-70" id="navHome">é¦–é¡µ</span>
</a>
<a href="portfolio.html" class="flex flex-col items-center gap-1 py-2 px-4">
<svg class="w-6 h-6 text-white opacity-70" fill="currentColor" viewBox="0 0 20 20"><path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/></svg>
<span class="text-xs font-bold text-white opacity-70" id="navAisight">æŠ•èµ„ç»„åˆ</span>
</a>
<a href="profile.html" class="flex flex-col items-center gap-1 py-2 px-4">
<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/></svg>
<span class="text-xs font-bold text-white" id="navProfile">ä¸ªäººä¸­å¿ƒ</span>
</a>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/he/1.2.0/he.min.js"></script>
<script>
let currentLang = localStorage.getItem('language') || 'zh';

const translations = {
zh: { username: 'æŠ•èµ„è€…', langTitle: 'è¯­è¨€è®¾ç½®', historyTitle: 'å†å²æŠ¥å‘Š', refreshBtn: 'åˆ·æ–°', navHome: 'é¦–é¡µ', navAisight: 'æŠ•èµ„ç»„åˆ', navProfile: 'ä¸ªäººä¸­å¿ƒ', noHistory: 'æš‚æ— åˆ†æè®°å½•', noHistoryDesc: 'å‰å¾€é¦–é¡µå¼€å§‹åˆ†æ', modalTitle: 'å®Œæ•´äº¤æ˜“å†³ç­–æŠ¥å‘Š', holding: 'æŒä»“ä¿¡æ¯', noHolding: 'æœªæŒä»“', cost: 'æˆæœ¬', shares: 'æŒè‚¡', currentPrice: 'å½“å‰ä»·', marketValue: 'å¸‚å€¼', pnl: 'ç›ˆäº', summary: 'ä¸€å¥è¯æ€»ç»“', phase: 'å½“å‰é˜¶æ®µ', shortTerm: 'çŸ­æœŸå»ºè®®', midTerm: 'ä¸­æœŸå»ºè®®', longTerm: 'é•¿æœŸå»ºè®®', keyLevels: 'å…³é”®ä»·ä½', support: 'æ”¯æ’‘ä½', resistance: 'é˜»åŠ›ä½', buyPoints: 'ä¹°å…¥èŠ‚ç‚¹å»ºè®®', sellPoints: 'å–å‡ºæ—¶é—´èŠ‚ç‚¹å»ºè®®', risks: 'æ ¸å¿ƒé£é™©', expectedGains: 'é¢„æœŸæ¶¨è·Œå¹…', short: 'çŸ­æœŸ', mid: 'ä¸­æœŸ', long: 'é•¿æœŸ', analysisTime: 'åˆ†ææ—¶é—´', langChanged: 'è¯­è¨€å·²åˆ‡æ¢', viewReport: 'åœ¨çº¿æŸ¥çœ‹', downloadReport: 'ä¸‹è½½æŠ¥å‘Š' },
en: { username: 'Investor', langTitle: 'Language', historyTitle: 'History', refreshBtn: 'Refresh', navHome: 'Home', navAisight: 'Portfolio', navProfile: 'Profile', noHistory: 'No records', noHistoryDesc: 'Go to Home to start', modalTitle: 'Complete Trading Decision Report', holding: 'Holdings', noHolding: 'No Holdings', cost: 'Cost', shares: 'Shares', currentPrice: 'Current Price', marketValue: 'Market Value', pnl: 'P&L', summary: 'Summary', phase: 'Current Phase', shortTerm: 'Short-Term', midTerm: 'Mid-Term', longTerm: 'Long-Term', keyLevels: 'Key Levels', support: 'Support', resistance: 'Resistance', buyPoints: 'Buy Points', sellPoints: 'Sell Points', risks: 'Core Risks', expectedGains: 'Expected Gains', short: 'Short', mid: 'Mid', long: 'Long', analysisTime: 'Analysis Time', langChanged: 'Language changed', viewReport: 'View Report', downloadReport: 'Download Report' },
es: { username: 'Inversor', langTitle: 'Idioma', historyTitle: 'Historial', refreshBtn: 'Actualizar', navHome: 'Inicio', navAisight: 'Portafolio', navProfile: 'Perfil', noHistory: 'Sin registros', noHistoryDesc: 'Ir a Inicio para empezar', modalTitle: 'Informe Completo', holding: 'Posiciones', noHolding: 'Sin Posiciones', cost: 'Costo', shares: 'Acciones', currentPrice: 'Precio Actual', marketValue: 'Valor', pnl: 'G/P', summary: 'Resumen', phase: 'Fase Actual', shortTerm: 'Corto Plazo', midTerm: 'Medio Plazo', longTerm: 'Largo Plazo', keyLevels: 'Niveles Clave', support: 'Soporte', resistance: 'Resistencia', buyPoints: 'Puntos Compra', sellPoints: 'Puntos Venta', risks: 'Riesgos', expectedGains: 'Ganancias Esperadas', short: 'Corto', mid: 'Medio', long: 'Largo', analysisTime: 'Tiempo AnÃ¡lisis', langChanged: 'Idioma cambiado', viewReport: 'Ver Informe', downloadReport: 'Descargar' }
};

function applyLanguage() {
const t = translations[currentLang];
document.getElementById('username').textContent = t.username;
document.getElementById('langTitle').textContent = t.langTitle;
document.getElementById('historyTitle').textContent = t.historyTitle;
document.getElementById('refreshBtn').textContent = t.refreshBtn;
document.getElementById('navHome').textContent = t.navHome;
document.getElementById('navAisight').textContent = t.navAisight;
document.getElementById('navProfile').textContent = t.navProfile;

['zh','en','es'].forEach(lang => {
const btn = document.getElementById('btn' + lang.charAt(0).toUpperCase() + lang.slice(1));
btn.className = lang === currentLang 
? 'py-3 rounded-xl font-bold transition-all bg-gradient-to-r from-purple-600 to-pink-600 text-white'
: 'py-3 rounded-xl font-bold transition-all bg-gray-200 text-gray-600';
});
}

function setLanguage(lang) {
currentLang = lang;
localStorage.setItem('language', lang);
applyLanguage();
loadHistory();
}

function loadHistory() {
const t = translations[currentLang];
const analyses = JSON.parse(localStorage.getItem('stockAnalyses') || '[]');
const list = document.getElementById('historyList');

console.log('Loading history, found', analyses.length, 'analyses');

if (analyses.length === 0) {
list.innerHTML = `<div class="text-center py-8 text-gray-400">
<div class="text-4xl mb-2">ğŸ“Š</div>
<div class="text-sm">${t.noHistory}</div>
<div class="text-xs mt-2">${t.noHistoryDesc}</div>
</div>`;
return;
}

list.innerHTML = analyses.slice(0, 20).map((item, idx) => {
const d = item.data || {};
const isUp = (d.change || 0) >= 0;
const border = isUp ? 'border-green-500' : 'border-red-500';
const textColor = isUp ? 'text-green-600' : 'text-red-600';

return `
<div class="bg-white/90 rounded-2xl p-4 border-l-4 ${border}">
<div class="flex justify-between items-center mb-2">
<div class="font-bold text-lg text-purple-600">${item.symbol}</div>
<div class="text-xs text-gray-500">${item.date.split(' ')[0]}</div>
</div>
<div class="flex justify-between items-center mb-3">
<div class="text-2xl font-bold">$${d.price ? d.price.toFixed(2) : 'N/A'}</div>
<div class="${textColor} font-bold">${isUp ? '+' : ''}${d.changePercent || 'N/A'}</div>
</div>
<div class="grid grid-cols-2 gap-2">
<button onclick="viewDetail(${idx})" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-2 px-4 rounded-xl text-sm active:scale-95 transition-all flex items-center justify-center gap-2">
<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/></svg>
${t.viewReport}
</button>
<button onclick="downloadReport(${idx})" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-2 px-4 rounded-xl text-sm active:scale-95 transition-all flex items-center justify-center gap-2">
<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
${t.downloadReport}
</button>
</div>
</div>
`;
}).join('');
}

function viewDetail(idx) {
const t = translations[currentLang];
const analyses = JSON.parse(localStorage.getItem('stockAnalyses') || '[]');
const item = analyses[idx];
if (!item) return;

const d = item.data || {};
const a = d.analysis || {};
const p = d.price || 0;
const isUp = (d.change || 0) >= 0;

document.getElementById('modalTitle').textContent = `${item.symbol} ${t.modalTitle}`;
document.getElementById('modalBody').innerHTML = `
<div class="space-y-4">
<div class="flex justify-between items-center pb-4 border-b-2 border-purple-600">
<div class="font-bold text-3xl text-purple-600">${item.symbol}</div>
<div class="text-right">
<div class="text-3xl font-bold">$${p.toFixed(2)}</div>
<div class="font-bold text-lg ${isUp ? 'text-green-600' : 'text-red-600'}">${isUp ? '+' : ''}${d.changePercent || 'N/A'}</div>
</div>
</div>

<div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-2xl p-5 text-base leading-relaxed">
<div class="font-bold text-lg mb-2">ğŸ’¡ ${t.summary}</div>
<div>${a.summary || ''}</div>
</div>

${a.phase ? `<div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4">
<h4 class="font-bold text-blue-700 mb-2 text-base">ğŸ“Š ${t.phase}</h4>
<div class="text-gray-800 text-sm">${a.phase}</div>
</div>` : ''}

${a.shortTerm ? `<div class="bg-green-50 border-l-4 border-green-500 rounded-xl p-4">
<div class="text-sm font-bold text-green-700 mb-2">${t.shortTerm}</div>
<div class="text-sm text-gray-800">${a.shortTerm}</div>
</div>` : ''}

${a.midTerm ? `<div class="bg-yellow-50 border-l-4 border-yellow-500 rounded-xl p-4">
<div class="text-sm font-bold text-yellow-700 mb-2">${t.midTerm}</div>
<div class="text-sm text-gray-800">${a.midTerm}</div>
</div>` : ''}

${a.longTerm ? `<div class="bg-blue-50 border-l-4 border-blue-500 rounded-xl p-4">
<div class="text-sm font-bold text-blue-700 mb-2">${t.longTerm}</div>
<div class="text-sm text-gray-800">${a.longTerm}</div>
</div>` : ''}

<div class="text-xs text-center text-gray-500 pt-4 border-t">
${t.analysisTime}: ${item.date}
</div>
</div>
`;

document.getElementById('modal').classList.add('show');
document.body.style.overflow = 'hidden';
}

function downloadReport(idx) {
const analyses = JSON.parse(localStorage.getItem('stockAnalyses') || '[]');
const item = analyses[idx];
if (!item) return;

const blob = new Blob([`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>${item.symbol} Report</title></head><body><h1>${item.symbol} Analysis Report</h1><p>Price: $${item.data.price}</p><p>Date: ${item.date}</p></body></html>`], { type: 'text/html' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `${item.symbol}_Report_${new Date().toISOString().split('T')[0]}.html`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
alert('âœ… Report downloaded!');
}

function closeModal() {
document.getElementById('modal').classList.remove('show');
document.body.style.overflow = '';
}

document.getElementById('modal').addEventListener('click', e => {
if (e.target.id === 'modal') closeModal();
});

document.addEventListener('keydown', e => {
if (e.key === 'Escape') closeModal();
});

const params = new URLSearchParams(window.location.search);
const symbol = params.get('symbol');

applyLanguage();
loadHistory();

if (symbol) {
const analyses = JSON.parse(localStorage.getItem('stockAnalyses') || '[]');
const idx = analyses.findIndex(a => a.symbol === symbol);
if (idx >= 0) setTimeout(() => viewDetail(idx), 500);
}
</script>

</body>
</html>
